<!DOCTYPE html>
<html>
<head>
  <title>Карта из Google Таблицы</title>
  <script src="https://api-maps.yandex.ru/2.1/?apikey=e99b0b22-e0ed-4965-89bd-c4ff4a9c1aed&lang=ru_RU"></script>
  <style>
    #map { width: 100%; height: 500px; margin-bottom: 20px; }
    #address-list { 
      font-family: Arial, sans-serif; 
      max-width: 800px; 
      margin: 0 auto; 
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .address-item { 
      padding: 8px; 
      border-bottom: 1px solid #eee; 
    }
    .address-item:last-child { border-bottom: none; }
    .address-label { font-weight: bold; color: #1a73e8; }
  </style>
</head>
<body>
  <h1 style="text-align: center;">Мои метки на карте</h1>
  <div id="map"></div>
  <div id="address-list">
    <h2 style="text-align: center;">Список адресов</h2>
    <!-- Сюда загрузится список -->
  </div>

  <script>
    ymaps.ready(init);

    function init() {
      const map = new ymaps.Map("map", { 
        center: [54.63, 39.74], // Рязань
        zoom: 12 
      });

      // Получаем данные из Google Apps Script
      fetch("https://script.google.com/macros/s/AKfycbw2jhg4RALhOuroZFdVAqPK9b75zkVbbvSscMRufyUUceQ1KdyjcnJKY2JlZObTTylR/exec")
        .then(response => response.json())
        .then(data => {
          const addressList = document.getElementById("address-list");
          let listHTML = "";

          data.forEach(item => {
            if (!item.address) return;

            // Добавляем метку на карту
            ymaps.geocode(item.address).then(function(res) {
              const firstGeoObject = res.geoObjects.get(0);
              const coordinates = firstGeoObject.geometry.getCoordinates();
              
              const placemark = new ymaps.Placemark(
                coordinates,
                { balloonContent: `<b>${item.label || "Метка"}</b><br>${item.address}` }
              );
              map.geoObjects.add(placemark);

              // Добавляем адрес в список под картой
              listHTML += `
                <div class="address-item">
                  <span class="address-label">${item.label || "Без названия"}:</span>
                  <span>${item.address}</span>
                </div>
              `;
              addressList.innerHTML += listHTML;
            });
          });
        });
    }
  </script>
</body>
</html>
